<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>Signature Capital</title>
<style>
  :root{
    --bg:#0f1720;
    --card:#0b1220;
    --accent:#0ea5a4;
    --muted:#8793a3;
    --gold:#d4af37;
    --white:#ffffff;
    --danger:#ffb4b4;
    --success:#7ef7b1;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial;
  }
  html,body{
    height:100%;
    margin:0;
    background:linear-gradient(180deg,#071021 0%, #091827 100%);
    color:var(--white);
    -webkit-font-smoothing:antialiased;
  }
  .app{
    max-width:420px;
    margin:0 auto;
    height:100vh;
    display:flex;
    flex-direction:column;
    box-shadow:0 0 40px rgba(0,0,0,.6);
    position:relative;
  }

  /* MAIN (no scroll) */
  #mainScreen{
    display:flex;
    flex-direction:column;
    height:100%;
  }

  .main-header{
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:8px;
    padding:14px 12px 6px;
    text-align:center;
    position:relative;
  }
  .header-left{
    width:100%;
    display:flex;
    flex-direction:column;
    align-items:center;
  }
  .app-title{
    font-size:20px;
    font-weight:700;
  }
  .app-sub{
    font-size:12px;
    color:var(--muted);
    margin-top:2px;
  }
  .top-actions{
    display:flex;
    gap:8px;
    margin-top:10px;
    width:100%;
    max-width:340px;
  }
  .top-btn{
    flex:1;
    background:rgba(14,165,164,0.08);
    border:1px solid rgba(14,165,164,0.25);
    border-radius:10px;
    padding:8px 6px 9px;
    font-size:12px;
    color:var(--white);
    cursor:pointer;
    display:flex;
    gap:6px;
    align-items:center;
    justify-content:center;
  }
  .logout-btn{
    background:transparent;
    border:1px solid rgba(255,255,255,0.15);
    padding:6px 10px;
    border-radius:8px;
    font-size:12px;
    cursor:pointer;
    position:absolute;
    top:10px;
    right:12px;
  }

  main{
    flex:1;
    overflow:hidden; /* no scroll on landing */
    display:flex;
    flex-direction:column;
    gap:0;
  }

  .center-wrap{
    width:100%;
    max-width:360px;
    margin:0 auto;
  }

  .send-form{
    padding:12px;
    background:linear-gradient(180deg,#071827,#06141c);
    border-radius:12px;
    margin:12px auto 0;
    display:none;
    flex-direction:column;
    gap:8px;
    max-width:360px;
    width:100%;
  }
  .field{display:flex;flex-direction:column;gap:6px}
  input[type="text"],input[type="number"],input[type="password"],select{
    padding:10px;
    border-radius:8px;
    border:1px solid rgba(255,255,255,0.06);
    background:transparent;
    color:var(--white);
    outline:none;
  }
  .row{display:flex;gap:8px}
  button.primary{
    background:var(--accent);
    border:none;
    padding:10px 12px;
    border-radius:10px;
    color:#fff;
    font-weight:600;
    cursor:pointer;
  }
  button.ghost{
    background:transparent;
    border:1px solid rgba(255,255,255,0.08);
    padding:10px 12px;
    border-radius:10px;
    color:#fff;
    font-weight:600;
    cursor:pointer;
  }

  /* sections */
  .section-head{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin:14px auto 6px;
    max-width:360px;
    width:100%;
  }
  .section-title{
    font-weight:700;
    font-size:15px;
  }
  .section-total{
    font-size:15px;
    font-weight:700;
    color:var(--white);
  }

  .account-list,
  .card-list{
    margin:0 auto;
    display:flex;
    flex-direction:column;
    gap:8px;
    width:100%;
    max-width:360px;
  }
  .list-item{
    background:rgba(255,255,255,0.02);
    border:1px solid rgba(255,255,255,0.017);
    border-radius:10px;
    padding:10px 12px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    cursor:pointer;
  }
  .item-left{
    display:flex;
    flex-direction:column;
    gap:3px;
  }
  .item-name{
    font-size:13px;
    font-weight:600;
  }
  .item-sub{
    font-size:11px;
    color:var(--muted);
  }
  .item-amt{
    font-size:14px;
    font-weight:700;
    color:var(--gold);
  }

  footer{
    padding:8px;
    text-align:center;
    font-size:12px;
    color:var(--muted);
  }

  .login-screen{
    position:fixed;
    inset:0;
    background:linear-gradient(180deg,#071021 0%, #091827 100%);
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:999;
    padding:20px;
  }
  .login-box{
    max-width:420px;
    width:100%;
    background:rgba(11,18,32,1);
    padding:22px;
    border-radius:16px;
    border:1px solid rgba(255,255,255,0.03);
  }

  /* detail screens (scrollable) */
  .screen{
    height:100%;
    display:flex;
    flex-direction:column;
  }
  .screen-header{
    display:flex;
    align-items:center;
    gap:10px;
    padding:12px;
    border-bottom:1px solid rgba(255,255,255,0.03);
  }
  .back-btn{
    background:transparent;
    border:1px solid rgba(255,255,255,0.1);
    width:30px;
    height:30px;
    border-radius:999px;
    color:#fff;
    cursor:pointer;
  }
  .screen-title{font-weight:700}
  .detail-body{
    flex:1;
    overflow:auto;
    padding:12px;
  }
  .transactions{display:flex;flex-direction:column;gap:8px}
  .tx{background:rgba(255,255,255,0.02);padding:12px;border-radius:10px;display:flex;justify-content:space-between;align-items:center}
  .tx-left{display:flex;flex-direction:column;gap:6px}
  .tx-merchant{font-weight:700}
  .tx-details{font-size:12px;color:var(--muted)}
  .tx-amount{font-weight:700}

  .cc-head-block{
    background:linear-gradient(98deg,rgba(252,165,165,0.05),rgba(12,20,35,0.2));
    border:1px solid rgba(252,165,165,0.1);
    border-radius:10px;
    padding:12px 12px 10px;
    margin-bottom:10px;
  }

  .maintenance-box{
    margin:18px 12px 0;
    background:rgba(255,255,255,0.02);
    border:1px solid rgba(255,255,255,0.03);
    border-radius:12px;
    padding:14px;
  }

  @media (max-width:420px){
    .app{height:100vh}
  }
</style>
</head>
<body>
<div class="app" id="app">

  <!-- MAIN SCREEN -->
  <div id="mainScreen" class="screen">
    <header class="main-header">
      <div class="header-left">
        <div class="app-title">Signature Capital</div>
        <div class="app-sub" id="welcomeLine">Welcome, Master Lighting Productions</div>
        <div class="top-actions">
          <button class="top-btn" id="depositBtn">ðŸ“· Deposit</button>
          <button class="top-btn" id="transferBtn">Transfer</button>
          <button class="top-btn" id="payCardBtn">Pay card</button>
        </div>
      </div>
      <button id="logoutBtn" class="logout-btn">Logout</button>
    </header>

    <main>
      <!-- SEND FORM -->
      <div class="send-form" id="sendForm">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="font-weight:700">Wire / Transfer</div>
          <div class="app-sub" id="currentBalanceSmall">$0.00</div>
        </div>

        <div class="field">
          <label class="app-sub">From account</label>
          <select id="fromAccount">
            <option value="business">Master Lighting Productions Inc.</option>
            <option value="personal">Menachem Boaron</option>
          </select>
        </div>

        <div class="field">
          <label class="app-sub">Send to</label>
          <select id="toAccount">
            <option value="manual">New recipient (enter details)</option>
            <option value="business">Master Lighting Productions Inc. (internal)</option>
            <option value="personal">Menachem Boaron (internal)</option>
          </select>
        </div>

        <div class="field">
          <label class="app-sub">Recipient name</label>
          <input id="recName" type="text" placeholder="Full name">
        </div>

        <div class="row">
          <div class="field" style="flex:1">
            <label class="app-sub">Routing / ABA</label>
            <input id="routing" type="text" placeholder="9 digits">
          </div>
          <div class="field" style="flex:1">
            <label class="app-sub">Account #</label>
            <input id="acctNo" type="text" placeholder="Account number">
          </div>
        </div>

        <div class="field">
          <label class="app-sub">Bank name</label>
          <input id="bankName" type="text" placeholder="Bank name">
        </div>

        <div class="field">
          <label class="app-sub">Amount (USD)</label>
          <input id="amount" type="number" placeholder="5000.00" min="0" step="0.01">
        </div>

        <div style="display:flex;gap:8px">
          <button id="confirmSend" class="primary">Confirm & Send</button>
          <button id="cancelSend" class="ghost">Cancel</button>
        </div>

        <div id="sendMessage" class="app-sub" style="color:#fca5a5"></div>
      </div>

      <!-- BANKING SECTION -->
      <div class="section-head">
        <div class="section-title">Banking</div>
        <div class="section-total" id="bankTotal">$0.00</div>
      </div>
      <div class="account-list">
        <div class="list-item" id="acctBusinessRow">
          <div class="item-left">
            <div class="item-name">Master Lighting Productions Inc.</div>
            <div class="item-sub">xâ€¢â€¢â€¢4821</div>
          </div>
          <div class="item-amt" id="balBusiness">$0.00</div>
        </div>
        <div class="list-item" id="acctPersonalRow">
          <div class="item-left">
            <div class="item-name">Menachem Boaron</div>
            <div class="item-sub">xâ€¢â€¢â€¢9374</div>
          </div>
          <div class="item-amt" id="balPersonal">$0.00</div>
        </div>
      </div>

      <!-- CREDIT CARDS SECTION -->
      <div class="section-head">
        <div class="section-title">Credit cards</div>
        <div class="section-total" id="ccTotalOwed">$0.00</div>
      </div>
      <div class="card-list">
        <div class="list-item" id="cardBusinessRow">
          <div class="item-left">
            <div class="item-name">Business Solutions Credit Card</div>
            <div class="item-sub">xâ€¢â€¢â€¢7712</div>
          </div>
          <div class="item-amt" id="ccOwedInline">$0.00</div>
        </div>
      </div>

    </main>

    <footer>Signature Capital</footer>
  </div>

  <!-- ACCOUNT DETAIL SCREEN -->
  <div id="accountScreen" class="screen" style="display:none">
    <div class="screen-header">
      <button class="back-btn" id="backFromAccount">&lt;</button>
      <div>
        <div class="screen-title" id="accDetailName">Account</div>
        <div class="app-sub" id="accDetailMask">xâ€¢â€¢â€¢</div>
      </div>
      <div style="margin-left:auto;display:flex;gap:6px">
        <button class="primary" id="accDetailTransferBtn">Transfer</button>
        <button class="logout-btn" id="logoutBtnAcc">Logout</button>
      </div>
    </div>
    <div class="detail-body">
      <div class="app-sub" style="margin-bottom:4px">Balance</div>
      <div class="app-title" id="accDetailBalance">$0.00</div>
      <div class="section-title" style="margin-top:16px;margin-bottom:4px">Transactions</div>
      <div id="accDetailTx" class="transactions"></div>
    </div>
  </div>

  <!-- CARD DETAIL SCREEN -->
  <div id="cardScreen" class="screen" style="display:none">
    <div class="screen-header">
      <button class="back-btn" id="backFromCard">&lt;</button>
      <div>
        <div class="screen-title">Business Solutions Credit Card</div>
        <div class="app-sub">xâ€¢â€¢â€¢7712</div>
      </div>
      <div style="margin-left:auto;display:flex;gap:6px">
        <button class="primary" id="cardPayBtn">Pay card</button>
        <button class="logout-btn" id="logoutBtnCard">Logout</button>
      </div>
    </div>
    <div class="detail-body">
      <div class="cc-head-block">
        <div class="app-sub">Current balance</div>
        <div class="app-title" id="ccOwed">$0.00</div>
        <div class="app-sub">Limit <span id="ccLimit">$0.00</span></div>
        <div class="app-sub">Available <span id="ccAvail">$0.00</span></div>
      </div>
      <div class="section-title" style="margin-bottom:4px">Transactions</div>
      <div id="txListCC" class="transactions"></div>
    </div>
  </div>

  <!-- DEPOSIT (MAINTENANCE) SCREEN -->
  <div id="depositScreen" class="screen" style="display:none">
    <div class="screen-header">
      <button class="back-btn" id="backFromDeposit">&lt;</button>
      <div>
        <div class="screen-title">Mobile deposit</div>
        <div class="app-sub">Check capture</div>
      </div>
      <div style="margin-left:auto">
        <button class="logout-btn" id="logoutBtnDep">Logout</button>
      </div>
    </div>
    <div class="detail-body">
      <div class="maintenance-box">
        <div class="section-title" style="margin-bottom:4px">Temporarily unavailable</div>
        <div class="app-sub">We are doing a scheduled maintenance on deposits. Please try again later.</div>
      </div>
    </div>
  </div>

</div>

<script>
(function(){
  const $ = id => document.getElementById(id);
  const formatCurrency = n => isNaN(n) ? "$0.00" : "$" + Number(n).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2});

  const DEFAULT_ACCOUNTS = {
    business: 12038450.72,
    personal: 2345980.34
  };
  const DEFAULT_CC = {
    owed: 49872.11,
    limit: 250000
  };
  const KEY = {
    AUTH: 'sigcap_demo_auth_v8',
    ACCOUNTS: 'sigcap_demo_accounts_v8',
    CC: 'sigcap_demo_cc_v8',
    TX_ACCOUNTS: 'sigcap_demo_tx_accounts_v8',
    TX_CC: 'sigcap_demo_tx_cc_v8'
  };

  const mainScreen = $('mainScreen');
  const accountScreen = $('accountScreen');
  const cardScreen = $('cardScreen');
  const depositScreen = $('depositScreen');

  const balBusiness = $('balBusiness');
  const balPersonal = $('balPersonal');
  const bankTotal = $('bankTotal');
  const ccTotalOwed = $('ccTotalOwed');
  const ccOwedInline = $('ccOwedInline');

  const sendForm = $('sendForm');
  const fromAccount = $('fromAccount');
  const toAccount = $('toAccount');
  const amountI = $('amount');
  const recName = $('recName');
  const routing = $('routing');
  const acctNo = $('acctNo');
  const bankName = $('bankName');
  const sendMessage = $('sendMessage');
  const currentBalanceSmall = $('currentBalanceSmall');

  const txListCC = $('txListCC');

  const accDetailName = $('accDetailName');
  const accDetailMask = $('accDetailMask');
  const accDetailBalance = $('accDetailBalance');
  const accDetailTx = $('accDetailTx');

  const ccOwed = $('ccOwed');
  const ccLimit = $('ccLimit');
  const ccAvail = $('ccAvail');

  const transferBtn = $('transferBtn');
  const depositBtn = $('depositBtn');
  const payCardBtn = $('payCardBtn');
  const confirmSend = $('confirmSend');
  const cancelSend = $('cancelSend');

  const logoutBtn = $('logoutBtn');
  const logoutBtnAcc = $('logoutBtnAcc');
  const logoutBtnCard = $('logoutBtnCard');
  const logoutBtnDep = $('logoutBtnDep');

  const backFromAccount = $('backFromAccount');
  const backFromCard = $('backFromCard');
  const backFromDeposit = $('backFromDeposit');

  const accDetailTransferBtn = $('accDetailTransferBtn');
  const cardPayBtn = $('cardPayBtn');

  let currentDetailAccount = null;

  if (!localStorage.getItem(KEY.AUTH)) {
    showLogin();
  } else {
    init();
  }

  function showLogin(){
    const overlay = document.createElement('div');
    overlay.className = 'login-screen';
    overlay.innerHTML = `
      <div class="login-box">
        <div style="font-weight:700;font-size:16px;margin-bottom:4px">Signature Capital</div>
        <div class="app-sub" style="margin-bottom:14px">Secure Banking Access</div>
        <div class="field">
          <label class="app-sub">Username</label>
          <input id="loginUser" type="text" placeholder="username">
        </div>
        <div class="field">
          <label class="app-sub">Password</label>
          <input id="loginPass" type="password" placeholder="password">
        </div>
        <div style="display:flex;gap:8px;margin-top:14px">
          <button id="loginBtn" class="primary" style="width:100%">Login</button>
        </div>
        <div style="margin-top:10px">
          <a class="fake-link" id="forgotBtn">Forgot password?</a>
        </div>
      </div>
    `;
    document.body.appendChild(overlay);

    overlay.querySelector('#loginBtn').addEventListener('click', ()=>{
      const u = overlay.querySelector('#loginUser').value.trim();
      const p = overlay.querySelector('#loginPass').value.trim();
      if (!u || !p){ alert('Enter username and password'); return; }
      localStorage.setItem(KEY.AUTH,'1');
      overlay.remove();
      init();
    });
    overlay.querySelector('#loginPass').addEventListener('keydown', e=>{
      if (e.key === 'Enter') overlay.querySelector('#loginBtn').click();
    });
    overlay.querySelector('#forgotBtn').addEventListener('click', ()=> alert('Demo only.'));
  }

  function init(){
    if (!localStorage.getItem(KEY.ACCOUNTS)) {
      localStorage.setItem(KEY.ACCOUNTS, JSON.stringify(DEFAULT_ACCOUNTS));
    }
    if (!localStorage.getItem(KEY.CC)) {
      localStorage.setItem(KEY.CC, JSON.stringify(DEFAULT_CC));
    }
    if (!localStorage.getItem(KEY.TX_ACCOUNTS)) {
      localStorage.setItem(KEY.TX_ACCOUNTS, JSON.stringify(generateAccountTXs()));
    }
    if (!localStorage.getItem(KEY.TX_CC)) {
      localStorage.setItem(KEY.TX_CC, JSON.stringify(generateCCTxs()));
    }

    bindUI();
    renderMain();
  }

  function bindUI(){
    $('acctBusinessRow').addEventListener('click', ()=> openAccountDetail('business'));
    $('acctPersonalRow').addEventListener('click', ()=> openAccountDetail('personal'));
    $('cardBusinessRow').addEventListener('click', ()=> openCardDetail());

    transferBtn.addEventListener('click', toggleSendForm);
    payCardBtn.addEventListener('click', ()=>{
      toggleSendForm(true);
      fromAccount.value = 'business';
      toAccount.value = 'manual';
      sendMessage.textContent = 'Tip: send a payment to the credit card (demo).';
      sendMessage.style.color = '#fca5a5';
      updateCurrentBalanceSmall();
    });
    depositBtn.addEventListener('click', ()=>{
      mainScreen.style.display = 'none';
      depositScreen.style.display = 'flex';
    });

    fromAccount.addEventListener('change', ()=> {
      updateCurrentBalanceSmall();
      autoFillRecipient();
    });
    toAccount.addEventListener('change', autoFillRecipient);
    cancelSend.addEventListener('click', ()=> sendForm.style.display = 'none');

    confirmSend.addEventListener('click', handleSend);

    [logoutBtn, logoutBtnAcc, logoutBtnCard, logoutBtnDep].forEach(btn=>{
      if (!btn) return;
      btn.addEventListener('click', ()=>{
        localStorage.removeItem(KEY.AUTH);
        location.reload();
      });
    });

    backFromAccount.addEventListener('click', ()=>{
      accountScreen.style.display = 'none';
      mainScreen.style.display = 'flex';
    });
    backFromCard.addEventListener('click', ()=>{
      cardScreen.style.display = 'none';
      mainScreen.style.display = 'flex';
    });
    backFromDeposit.addEventListener('click', ()=>{
      depositScreen.style.display = 'none';
      mainScreen.style.display = 'flex';
    });

    accDetailTransferBtn.addEventListener('click', ()=>{
      accountScreen.style.display = 'none';
      mainScreen.style.display = 'flex';
      fromAccount.value = currentDetailAccount || 'business';
      toggleSendForm(true);
    });

    cardPayBtn.addEventListener('click', ()=>{
      cardScreen.style.display = 'none';
      mainScreen.style.display = 'flex';
      fromAccount.value = 'business';
      toggleSendForm(true);
      sendMessage.textContent = 'Payment to credit card from business (demo).';
      sendMessage.style.color = '#fca5a5';
    });
  }

  function toggleSendForm(forceOpen){
    if (forceOpen){
      sendForm.style.display = 'flex';
      updateCurrentBalanceSmall();
      return;
    }
    sendForm.style.display = sendForm.style.display === 'flex' ? 'none' : 'flex';
    updateCurrentBalanceSmall();
  }

  function autoFillRecipient(){
    const toVal = toAccount.value;
    if (toVal === 'business'){
      recName.value = 'Master Lighting Productions Inc.';
      routing.value = '026009593';
      acctNo.value = '00004821';
      bankName.value = 'Signature Capital Bank';
    } else if (toVal === 'personal'){
      recName.value = 'Menachem Boaron';
      routing.value = '026009594';
      acctNo.value = '00009374';
      bankName.value = 'Signature Capital Bank';
    } else {
      recName.value = '';
      routing.value = '';
      acctNo.value = '';
      bankName.value = '';
    }
  }

  function updateCurrentBalanceSmall(){
    const accounts = JSON.parse(localStorage.getItem(KEY.ACCOUNTS) || '{}');
    const a = fromAccount.value;
    const bal = Number(accounts[a] || 0);
    currentBalanceSmall.textContent = formatCurrency(bal);
  }

  function handleSend(){
    sendMessage.style.color = '#fca5a5';
    sendMessage.textContent = '';
    const amt = Number(amountI.value);
    if (!amt || isNaN(amt) || amt <= 0) return sendMessage.textContent = 'Enter valid amount';

    const accs = JSON.parse(localStorage.getItem(KEY.ACCOUNTS) || '{}');
    const from = fromAccount.value;
    const cur = Number(accs[from] || 0);
    if (amt > cur) return sendMessage.textContent = 'Insufficient funds';

    const toVal = toAccount.value;
    const accTxs = JSON.parse(localStorage.getItem(KEY.TX_ACCOUNTS) || '[]');

    accs[from] = Number((cur - amt).toFixed(2));

    if (toVal === 'business' || toVal === 'personal'){
      if (toVal === from){
        sendMessage.textContent = 'Cannot transfer to same account';
        return;
      }
      const targetBal = Number(accs[toVal] || 0);
      accs[toVal] = Number((targetBal + amt).toFixed(2));
      localStorage.setItem(KEY.ACCOUNTS, JSON.stringify(accs));

      accTxs.unshift({
        id: 'int_out_' + Date.now(),
        account: from,
        merchant: toVal === 'business' ? 'Transfer to Master Lighting Productions Inc.' : 'Transfer to Menachem Boaron',
        amount: amt,
        iso: new Date().toISOString(),
        dir: 'out',
        note: ''
      });

      accTxs.unshift({
        id: 'int_in_' + Date.now(),
        account: toVal,
        merchant: from === 'business' ? 'Transfer from Master Lighting Productions Inc.' : 'Transfer from Menachem Boaron',
        amount: amt,
        iso: new Date().toISOString(),
        dir: 'in',
        note: ''
      });

      localStorage.setItem(KEY.TX_ACCOUNTS, JSON.stringify(accTxs.slice(0,500)));
      renderMain();
      sendMessage.style.color = '#9cf7b9';
      sendMessage.textContent = 'Transfer completed.';
      setTimeout(()=> sendForm.style.display='none', 900);
      return;
    } else {
      accs[from] = Number((cur - amt).toFixed(2));
      localStorage.setItem(KEY.ACCOUNTS, JSON.stringify(accs));
      accTxs.unshift({
        id: 'wire_' + Date.now(),
        account: from,
        merchant: 'Wire to ' + (recName.value || 'Recipient'),
        amount: amt,
        iso: new Date().toISOString(),
        dir: 'out',
        note: (acctNo.value ? 'Acct ' + acctNo.value : '') + (bankName.value ? ' â€¢ ' + bankName.value : '')
      });
      localStorage.setItem(KEY.TX_ACCOUNTS, JSON.stringify(accTxs.slice(0,500)));
      renderMain();
      sendMessage.style.color = '#9cf7b9';
      sendMessage.textContent = 'Wire sent.';
      setTimeout(()=> sendForm.style.display='none', 900);
    }
  }

  function renderMain(){
    const accs = JSON.parse(localStorage.getItem(KEY.ACCOUNTS) || '{}');
    const biz = Number(accs.business || 0);
    const per = Number(accs.personal || 0);
    const total = biz + per;

    balBusiness.textContent = formatCurrency(biz);
    balPersonal.textContent = formatCurrency(per);
    bankTotal.textContent = formatCurrency(total);

    const cc = JSON.parse(localStorage.getItem(KEY.CC) || '{}');
    const owed = Number(cc.owed || 0);
    ccTotalOwed.textContent = formatCurrency(owed);
    ccOwedInline.textContent = formatCurrency(owed);
  }

  function openAccountDetail(which){
    currentDetailAccount = which;
    const accs = JSON.parse(localStorage.getItem(KEY.ACCOUNTS) || '{}');
    const accTxs = JSON.parse(localStorage.getItem(KEY.TX_ACCOUNTS) || '[]');
    const bal = Number(accs[which] || 0);

    accDetailName.textContent = which === 'business' ? 'Master Lighting Productions Inc.' : 'Menachem Boaron';
    accDetailMask.textContent = which === 'business' ? 'xâ€¢â€¢â€¢4821' : 'xâ€¢â€¢â€¢9374';
    accDetailBalance.textContent = formatCurrency(bal);

    accDetailTx.innerHTML = '';
    accTxs.filter(t=>t.account===which).slice(0,200).forEach(tx=>{
      const d = new Date(tx.iso);
      const isIn = tx.dir === 'in';
      const row = document.createElement('div');
      row.className = 'tx';
      row.innerHTML = `
        <div class="tx-left">
          <div class="tx-merchant">${escapeHtml(tx.merchant)}</div>
          <div class="tx-details">${d.toLocaleDateString()}${tx.note ? ' â€¢ '+escapeHtml(tx.note):''}</div>
        </div>
        <div class="tx-amount" style="color:${isIn ? '#7ef7b1' : '#ffb4b4'}">
          ${isIn ? '+' : '-'}${formatCurrency(tx.amount).replace('$','')}
        </div>
      `;
      accDetailTx.appendChild(row);
    });

    mainScreen.style.display = 'none';
    accountScreen.style.display = 'flex';
  }

  function openCardDetail(){
    const cc = JSON.parse(localStorage.getItem(KEY.CC) || '{}');
    const owed = Number(cc.owed || 0);
    const limit = Number(cc.limit || 0);
    const avail = limit - owed;

    ccOwed.textContent = formatCurrency(owed);
    ccLimit.textContent = formatCurrency(limit);
    ccAvail.textContent = formatCurrency(avail);

    const ccTxs = JSON.parse(localStorage.getItem(KEY.TX_CC) || '[]');
    txListCC.innerHTML = '';
    ccTxs.slice(0,200).forEach(tx=>{
      const d = new Date(tx.iso);
      const isPayment = tx.dir === 'in';
      const row = document.createElement('div');
      row.className = 'tx';
      row.innerHTML = `
        <div class="tx-left">
          <div class="tx-merchant">${escapeHtml(tx.merchant)}</div>
          <div class="tx-details">${d.toLocaleDateString()}${tx.note ? ' â€¢ '+escapeHtml(tx.note):''}</div>
        </div>
        <div class="tx-amount" style="color:${isPayment ? '#7ef7b1' : '#ffb4b4'}">
          ${isPayment ? '+' : '-'}${formatCurrency(tx.amount).replace('$','')}
        </div>
      `;
      txListCC.appendChild(row);
    });

    mainScreen.style.display = 'none';
    cardScreen.style.display = 'flex';
  }

  function generateAccountTXs(){
    const list = [];
    const now = Date.now();

    const businessOutgoing = [
      {m:"Robe Lighting US", min:18500, max:92000},
      {m:"Chauvet Professional", min:8500, max:45000},
      {m:"PRG New York", min:22000, max:155000},
      {m:"4Wall Entertainment", min:18000, max:93000},
      {m:"Solotech USA", min:16000, max:80000},
      {m:"U-Haul Brooklyn", min:500, max:2200},
      {m:"NYC Trucking Co.", min:950, max:4800},
      {m:"Chubb Insurance", min:900, max:3800},
      {m:"Con Edison", min:680, max:4200},
      {m:"NY Stage & Rigging Supply", min:1200, max:9800}
    ];

    const businessIncoming = [
      "Cipriani Events LLC",
      "Hamptons Event Group",
      "Greenberg Family Productions",
      "Park Avenue Wedding Co.",
      "Soho Gala Management",
      "Temple Beth Shalom",
      "Shulman & Co. Event Dept.",
      "Upper East Productions"
    ];

    const personalOutgoing = [
      {m:"Chelsea Piers Fitness", amt:350.00},
      {m:"Trader Joe's", min:90, max:240},
      {m:"Whole Foods Market", min:140, max:310},
      {m:"Payment to Credit Card", min:800, max:1500},
      {m:"Noam Activities", min:75, max:120},
      {m:"Apple Services", amt:49.99},
      {m:"Transfer to Business Card", min:300, max:900},
      {m:"Sephora", min:120, max:460}
    ];

    const personalIncoming = [
      "Transfer from Master Lighting Productions Inc.",
      "Refund - Online Purchase",
      "Deposit from Client"
    ];

    // Business txs
    for (let i=0;i<32;i++){
      const isIncoming = i % 5 === 0;
      if (isIncoming){
        const name = businessIncoming[Math.floor(Math.random()*businessIncoming.length)];
        list.push({
          id:'biz_in_'+i,
          account:'business',
          merchant:name,
          amount:Number((6000 + Math.random()*90000).toFixed(2)),
          iso:new Date(now - i*45*60*1000).toISOString(),
          dir:'in',
          note:''
        });
      } else {
        const pick = businessOutgoing[Math.floor(Math.random()*businessOutgoing.length)];
        const amount = Number((pick.min + Math.random()*(pick.max - pick.min)).toFixed(2));
        list.push({
          id:'biz_out_'+i,
          account:'business',
          merchant:pick.m,
          amount,
          iso:new Date(now - i*58*60*1000).toISOString(),
          dir:'out',
          note:''
        });
      }
    }

    // Personal txs
    for (let j=0;j<22;j++){
      const isIncoming = j % 6 === 0;
      if (isIncoming){
        const m = personalIncoming[Math.floor(Math.random()*personalIncoming.length)];
        list.push({
          id:'per_in_'+j,
          account:'personal',
          merchant:m,
          amount:Number((300 + Math.random()*5000).toFixed(2)),
          iso:new Date(now - j*88*60*1000).toISOString(),
          dir:'in',
          note:''
        });
      } else {
        const p = personalOutgoing[Math.floor(Math.random()*personalOutgoing.length)];
        let amt = p.amt !== undefined ? p.amt : Number((p.min + Math.random()*(p.max - p.min)).toFixed(2));
        list.push({
          id:'per_out_'+j,
          account:'personal',
          merchant:p.m,
          amount:amt,
          iso:new Date(now - j*90*60*1000).toISOString(),
          dir:'out',
          note:''
        });
      }
    }

    list.sort((a,b)=> new Date(b.iso) - new Date(a.iso));
    return list;
  }

  function generateCCTxs(){
    const luxury = [
      "Louis Vuitton 5th Ave",
      "Prada Soho",
      "Gucci Madison",
      "Dior Boutique",
      "Cartier NYC",
      "Fendi Boutique"
    ];
    const dining = ["Nobu","Carbone","Cipriani Downtown","The Modern","Pastis","Casa Cipriani","L'Avenue at Saks"];
    const travel = ["Delta Airlines","El Al Israel","Four Seasons","Ritz Carlton","Uber","Uber Black","Lyft","Doordash","JetBlue"];
    const txs = [];
    const now = Date.now();
    let i = 0;

    luxury.forEach(m=>{
      txs.push({
        id:'cc_lux_'+i,
        merchant:m,
        amount:Number((4000 + Math.random()*9000).toFixed(2)),
        iso:new Date(now - i*40*60*1000).toISOString(),
        dir:'out',
        note:'CC Purchase'
      });
      i++;
    });

    for (let j=0;j<45;j++){
      const pick = Math.random();
      let merchant, amount;
      if (pick < 0.3){
        merchant = dining[Math.floor(Math.random()*dining.length)];
        amount = Number((150 + Math.random()*600).toFixed(2));
      } else if (pick < 0.7){
        merchant = travel[Math.floor(Math.random()*travel.length)];
        amount = Number((25 + Math.random()*800).toFixed(2));
      } else {
        merchant = "Online Purchase";
        amount = Number((50 + Math.random()*400).toFixed(2));
      }
      txs.push({
        id:'cc_'+i,
        merchant,
        amount,
        iso:new Date(now - i*70*60*1000).toISOString(),
        dir:'out',
        note:''
      });
      i++;
    }

    // payments & refunds
    txs.unshift({
      id:'cc_pay_1',
      merchant:'Payment - Master Lighting Productions Inc.',
      amount:15000.00,
      iso:new Date(now - 20*60*1000).toISOString(),
      dir:'in',
      note:''
    });
    txs.unshift({
      id:'cc_refund_1',
      merchant:'Refund - Dior Boutique',
      amount:2100.00,
      iso:new Date(now - 10*60*1000).toISOString(),
      dir:'in',
      note:''
    });

    txs.sort((a,b)=> new Date(b.iso) - new Date(a.iso));
    return txs;
  }

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, m => ({
      '&':'&amp;',
      '<':'&lt;',
      '>':'&gt;',
      '"':'&quot;',
      "'":'&#39;'
    }[m]));
  }

})();
</script>
</body>
</html>
